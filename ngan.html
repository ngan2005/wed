<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Shop M·ªπ Ph·∫©m - Shopee Style</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      background: #f5f5f5;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .navbar {
      background: linear-gradient(90deg, #ff5722 0%, #ff8a65 100%);
      box-shadow: 0 2px 8px #d6338440;
      padding: 0 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .navbar h1 {
      color: #fff;
      font-size: 28px;
      margin: 0;
      font-weight: bold;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .navbar h1 i {
      color: #fff;
      font-size: 32px;
    }
    .navbar .search-bar {
      flex: 1;
      margin: 0 32px;
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 8px;
      padding: 4px 8px;
    }
    .navbar input[type="text"] {
      width: 300px;
      padding: 8px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
      outline: none;
      background: transparent;
      color: #333;
    }
    .navbar button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: #ff5722;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      margin-left: 8px;
      transition: background 0.2s;
    }
    .navbar button:hover {
      background: #d63384;
    }
    .navbar .user {
      font-size: 16px;
      color: #fff;
      margin-right: 16px;
    }
    .cart-icon {
      position: relative;
      margin-left: 24px;
      cursor: pointer;
      color: #fff;
      font-size: 28px;
      transition: color 0.2s;
    }
    .cart-icon:hover {
      color: #d63384;
    }
    .cart-count {
      position: absolute;
      top: -8px;
      right: -12px;
      background: #d63384;
      color: #fff;
      border-radius: 50%;
      padding: 2px 7px;
      font-size: 13px;
      font-weight: bold;
      border: 2px solid #fff;
    }
    .container {
      max-width: 1200px;
      margin: 32px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #d6338440;
      padding: 32px;
      min-height: 600px;
    }
    .banner {
      width: 100%;
      height: 120px;
      background: url('https://cf.shopee.vn/file/vn-50009109-7e4e2b6e7b6e7b6e7b6e7b6e7b6e7b6e') center/cover no-repeat;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 32px;
      font-weight: bold;
      letter-spacing: 2px;
      text-shadow: 2px 2px 8px #d63384;
      position: relative;
      overflow: hidden;
    }
    .banner::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, #ff5722cc 0%, #ff8a65cc 100%);
      opacity: 0.7;
      border-radius: 12px;
    }
    .banner span {
      position: relative;
      z-index: 1;
    }
    .filter-bar {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      align-items: center;
      flex-wrap: wrap;
      background: #fff0f6;
      border-radius: 8px;
      padding: 12px 16px;
    }
    .filter-bar select, .filter-bar input {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #d63384;
      font-size: 15px;
      background: #fff;
      color: #ad1457;
    }
    .product-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    .product-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #d6338440;
      padding: 16px;
      text-align: center;
      transition: box-shadow 0.2s, transform 0.2s;
      position: relative;
      border: 1px solid #ffe4ef;
      cursor: pointer;
    }
    .product-card:hover {
      box-shadow: 0 4px 16px #d6338440;
      transform: translateY(-4px) scale(1.03);
      border-color: #ff5722;
    }
    .product-card img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
      background: #fff;
      box-shadow: 0 2px 8px #d6338440;
      border: 1px solid #ffe4ef;
    }
    .product-card .product-name {
      font-weight: bold;
      color: #d63384;
      font-size: 18px;
      margin-bottom: 6px;
      min-height: 24px;
    }
    .product-card .product-price {
      color: #ff5722;
      font-size: 16px;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .product-card .star {
      color: #ffcc00;
      font-size: 18px;
      margin: 0 1px;
      cursor: pointer;
    }
    .product-card .stock {
      color: #ad1457;
      font-size: 13px;
      margin-bottom: 6px;
    }
    .product-card button {
      background: linear-gradient(90deg, #ff5722 0%, #d63384 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 15px;
      margin-top: 8px;
      font-weight: bold;
      box-shadow: 0 2px 8px #d6338440;
      transition: background 0.2s;
    }
    .product-card button:disabled {
      background: #ccc;
      color: #fff;
      cursor: not-allowed;
    }
    .product-card button:hover:not(:disabled) {
      background: #ad1457;
    }
    .cart {
      background: #fff0f6;
      border-radius: 12px;
      box-shadow: 0 2px 8px #d6338440;
      padding: 24px;
      margin-bottom: 32px;
    }
    .cart h2 {
      color: #d63384;
      margin-top: 0;
      font-size: 22px;
    }
    .cart-list {
      list-style: none;
      padding: 0;
      margin: 0 0 16px 0;
    }
    .cart-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #ffe4ef;
      font-size: 15px;
      color: #ad1457;
    }
    .cart-list img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 8px;
      margin-right: 12px;
      border: 1px solid #ffe4ef;
    }
    .cart-total {
      font-weight: bold;
      color: #ff5722;
      font-size: 18px;
      margin-bottom: 12px;
    }
    .cart button {
      background: linear-gradient(90deg, #ff5722 0%, #d63384 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 24px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 2px 8px #d6338440;
      transition: background 0.2s;
    }
    .cart button:hover {
      background: #d63384;
    }
    .service-btns {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      justify-content: center;
    }
    .service-btns button {
      background: linear-gradient(90deg, #ff5722 0%, #d63384 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 20px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      box-shadow: 0 2px 8px #d6338440;
      transition: background 0.2s;
    }
    .service-btns button:hover {
      background: #ad1457;
    }
    .service-form {
      background: #fff0f6;
      border-radius: 12px;
      box-shadow: 0 2px 8px #d6338440;
      padding: 24px;
      margin-bottom: 24px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .service-form label {
      font-weight: bold;
      margin-bottom: 8px;
      display: block;
      color: #d63384;
    }
    .service-form input, .service-form select {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #d63384;
      font-size: 15px;
      background: #fff;
      color: #ad1457;
    }
    .service-form button {
      background: linear-gradient(90deg, #ff5722 0%, #d63384 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 20px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      box-shadow: 0 2px 8px #d6338440;
      transition: background 0.2s;
    }
    .service-form button:hover {
      background: #ad1457;
    }
    #welcome {
      margin-bottom: 16px;
      font-weight: bold;
      color: #ad1457;
      text-align: right;
    }
    #userInfo {
      display:none;
      margin-bottom:16px;
      background:#fff0f6;
      padding:12px;
      border-radius:8px;
      box-shadow:0 2px 8px #d6338440;
      color:#ad1457;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    #userInfo img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 8px;
      background: #fff;
      border: 1px solid #ffe4ef;
    }
    .logout-btn {
      background: linear-gradient(90deg, #ff5722 0%, #d63384 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 6px 16px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 12px;
      font-weight: bold;
      box-shadow: 0 2px 8px #d6338440;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #ad1457;
    }
    .toast {
      position: fixed;
      top: 24px;
      right: 24px;
      background: #ff5722;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      box-shadow: 0 2px 8px #d6338440;
      z-index: 9999;
      display: none;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 32px;
      max-width: 400px;
      margin: auto;
      position: relative;
      text-align: center;
      box-shadow: 0 2px 8px #d6338440;
    }
    .modal-content img {
      width: 160px;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid #ffe4ef;
    }
    .close-modal {
      position: absolute;
      top: 12px;
      right: 18px;
      font-size: 22px;
      color: #ad1457;
      cursor: pointer;
      font-weight: bold;
    }
    .history {
      background: #fff0f6;
      border-radius: 12px;
      box-shadow: 0 2px 8px #d6338440;
      padding: 24px;
      margin-bottom: 32px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .history h2 {
      color: #d63384;
      margin-top: 0;
      font-size: 20px;
    }
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .history-list li {
      padding: 8px 0;
      border-bottom: 1px solid #ffe4ef;
      font-size: 15px;
      color: #ad1457;
    }
    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeout {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    @media (max-width: 700px) {
      .container { padding: 4px; }
      .navbar { flex-direction: column; height: auto; padding: 8px 0; }
      .navbar .search-bar { margin: 12px 0; width: 100%; }
      .navbar input[type="text"] { width: 100%; }
      .product-list { grid-template-columns: 1fr 1fr; gap: 12px; }
      .banner { font-size: 20px; height: 80px; }
      .cart, .service-form, .history { padding: 8px; }
      .product-card img { width: 90px; height: 90px; }
      .product-card { padding: 8px; }
      .modal-content { padding: 8px; }
      .cart-list li { font-size: 13px; }
    }
    @media (max-width: 500px) {
      .container { padding: 2px; }
      .navbar { flex-direction: column; height: auto; padding: 4px 0; }
      .navbar .search-bar { margin: 8px 0; width: 100%; flex-wrap: wrap; }
      .navbar input[type="text"] { width: 100%; margin-bottom: 4px; }
      .product-list { grid-template-columns: 1fr; gap: 8px; }
      .banner { font-size: 16px; height: 60px; }
      .cart, .service-form, .history { padding: 4px; }
      .product-card img { width: 70px; height: 70px; }
      .product-card { padding: 4px; font-size: 13px; }
      .modal-content { padding: 4px; }
      .cart-list li { font-size: 12px; }
      .service-btns { flex-direction: column; gap: 8px; }
    }
    /* Th√™m th√¥ng b√°o realtime khi c√≥ khuy·∫øn m√£i ho·∫∑c ƒë∆°n h√†ng thay ƒë·ªïi tr·∫°ng th√°i */
    #notificationBar {
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      z-index:99999;
      background:#ffcc00;
      color:#ad1457;
      text-align:center;
      padding:12px;
      font-weight:bold;
      box-shadow:0 2px 8px #d6338440;
    }
  </style>
  <script>
    let users = [];
    let loggedInUser = null;
    let cart = [];
    let history = [];
    let productRatings = {};
    let productComments = {};

    // Danh s√°ch s·∫£n ph·∫©m, h√¨nh ·∫£nh v√† gi√° ti·ªÅn (h√¨nh ·∫£nh ph√π h·ª£p t·ª´ng lo·∫°i)
    const products = [
      {
        name: "Son m√¥i",
        img: "https://cdn.pixabay.com/photo/2016/11/29/05/08/lipstick-1869238_1280.jpg",
        price: 150000,
        type: "Trang ƒëi·ªÉm",
        desc: "Son m√¥i cao c·∫•p, m√†u s·∫Øc t∆∞∆°i t·∫Øn, l√¢u tr√¥i."
      },
      {
        name: "Kem d∆∞·ª°ng",
        img: "https://cdn.pixabay.com/photo/2017/08/07/00/32/moisturizer-2596083_1280.jpg",
        price: 220000,
        type: "ChƒÉm s√≥c da",
        desc: "Kem d∆∞·ª°ng ·∫©m gi√∫p da m·ªÅm m·ªãn, tr·∫Øng s√°ng."
      },
      {
        name: "M·∫∑t n·∫°",
        img: "https://cdn.pixabay.com/photo/2017/08/07/00/32/facemask-2596082_1280.jpg",
        price: 35000,
        type: "ChƒÉm s√≥c da",
        desc: "M·∫∑t n·∫° d∆∞·ª°ng da, c·∫•p ·∫©m v√† l√†m d·ªãu da."
      },
      {
        name: "Ph·∫•n ph·ªß",
        img: "https://cdn.pixabay.com/photo/2016/11/29/05/08/powder-1869237_1280.jpg",
        price: 180000,
        type: "Trang ƒëi·ªÉm",
        desc: "Ph·∫•n ph·ªß m·ªãn, ki·ªÉm so√°t d·∫ßu, gi·ªØ l·ªõp n·ªÅn l√¢u tr√¥i."
      },
      {
        name: "S·ªØa r·ª≠a m·∫∑t",
        img: "https://cdn.pixabay.com/photo/2017/08/07/00/32/cleanser-2596084_1280.jpg",
        price: 95000,
        type: "ChƒÉm s√≥c da",
        desc: "S·ªØa r·ª≠a m·∫∑t d·ªãu nh·∫π, l√†m s·∫°ch s√¢u, kh√¥ng kh√¥ da."
      },
      {
        name: "T·∫©y trang",
        img: "https://cdn.pixabay.com/photo/2017/08/07/00/32/makeup-remover-2596085_1280.jpg",
        price: 120000,
        type: "ChƒÉm s√≥c da",
        desc: "N∆∞·ªõc t·∫©y trang s·∫°ch s√¢u, kh√¥ng g√¢y k√≠ch ·ª©ng."
      },
      {
        name: "Kem ch·ªëng n·∫Øng",
        img: "https://cdn.pixabay.com/photo/2017/08/07/00/32/sunscreen-2596086_1280.jpg",
        price: 210000,
        type: "ChƒÉm s√≥c da",
        desc: "Kem ch·ªëng n·∫Øng SPF50+, b·∫£o v·ªá da kh·ªèi tia UV."
      },
      {
        name: "Serum",
        img: "https://cdn.pixabay.com/photo/2017/08/07/00/32/serum-2596087_1280.jpg",
        price: 250000,
        type: "ChƒÉm s√≥c da",
        desc: "Serum d∆∞·ª°ng da, ch·ªëng l√£o h√≥a, ph·ª•c h·ªìi da."
      }
    ];

    function showRegister() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'block';
    }

    function showLogin() {
      document.getElementById('registerForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }

    function registerAccount() {
      const username = document.getElementById('regUsername').value.trim();
      const password = document.getElementById('regPassword').value;
      if (!username || !password) {
        alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
        return;
      }
      if (users.find(u => u.username === username)) {
        alert('T√™n t√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!');
        return;
      }
      users.push({ username, password, avatar: "", bg: "", history: [] });
      alert('ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p.');
      showLogin();
    }

    function loginAccount() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      const welcome = document.getElementById('welcome');
      if (!username || !password) {
        alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
        return;
      }
      const user = users.find(u => u.username === username && u.password === password);
      if (!user) {
        alert('Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!');
        return;
      }
      loggedInUser = username;
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'none';
      welcome.innerHTML = 'Xin ch√†o, ' + username + ' <button class="logout-btn" onclick="logout()">ƒêƒÉng xu·∫•t</button>';
      document.getElementById('mainContent').style.display = 'block';
      showUserInfo();
      renderProducts();
      renderCart();
      renderHistory();
      updateCartIcon();
      if (user.bg) {
        document.body.style.background = `url('${user.bg}') no-repeat center center fixed`;
        document.body.style.backgroundSize = 'cover';
      }
    }

    function logout() {
      loggedInUser = null;
      document.getElementById('mainContent').style.display = 'none';
      document.getElementById('userInfo').style.display = 'none';
      document.getElementById('welcome').textContent = '';
      document.getElementById('loginForm').style.display = 'block';
      cart = [];
      updateCartIcon();
      document.body.style.background = "url('https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?auto=format&fit=crop&w=800&q=80') no-repeat center center fixed";
      document.body.style.backgroundSize = 'cover';
    }

    function showUserInfo() {
      const user = users.find(u => u.username === loggedInUser);
      document.getElementById('userInfo').style.display = 'block';
      document.getElementById('infoUsername').textContent = user.username;
      if (user.avatar) {
        document.getElementById('infoAvatar').src = user.avatar;
        document.getElementById('infoAvatar').style.display = 'block';
      } else {
        document.getElementById('infoAvatar').style.display = 'none';
      }
    }

    function updateBg(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.body.style.background = `url('${e.target.result}') no-repeat center center fixed`;
          document.body.style.backgroundSize = 'cover';
          const user = users.find(u => u.username === loggedInUser);
          user.bg = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    function updateAvatar(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const user = users.find(u => u.username === loggedInUser);
          user.avatar = e.target.result;
          showUserInfo();
        };
        reader.readAsDataURL(file);
      }
    }

    // Qu·∫£n l√Ω kho n√¢ng c·∫•p: c·∫£nh b√°o khi s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng, t·ª± ƒë·ªông ·∫©n khi h·∫øt h√†ng

    // S·ªë l∆∞·ª£ng c·∫£nh b√°o h·∫øt h√†ng
    const STOCK_WARNING = 3;

    // S·ª≠a l·∫°i h√†m renderProducts ƒë·ªÉ hi·ªÉn th·ªã c·∫£nh b√°o v√† ·∫©n s·∫£n ph·∫©m h·∫øt h√†ng
    function renderProducts(filter = "", type = "", price = "") {
      const list = document.getElementById('productList');
      let filtered = products;
      if (filter) {
        filtered = filtered.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
      }
      if (type) {
        filtered = filtered.filter(p => p.type === type);
      }
      if (price) {
        if (price === "1") filtered = filtered.filter(p => p.price < 100000);
        if (price === "2") filtered = filtered.filter(p => p.price >= 100000 && p.price < 200000);
        if (price === "3") filtered = filtered.filter(p => p.price >= 200000);
      }
      filtered = filtered.filter(product => stock[product.name] > 0);

      // L·∫•y danh s√°ch y√™u th√≠ch c·ªßa user
      const favs = userFavorites[loggedInUser] || [];

      list.innerHTML = filtered.map(product => {
        const ratingArr = productRatings[product.name] || [];
        const rating = ratingArr.length ? Math.round(ratingArr.reduce((a,b)=>a+b,0)/ratingArr.length) : 0;
        let stockMsg = "";
        if (stock[product.name] <= STOCK_WARNING) {
          stockMsg = `<span style="color:#ff5722;font-weight:bold;">S·∫Øp h·∫øt h√†ng!</span>`;
        }
        const isFav = favs.includes(product.name);
        return `
        <div class="product-card">
          <img src="${product.img}" alt="${product.name}" onclick="showDetail('${product.name}')">
          <div class="product-name">${product.name}</div>
          <div class="product-price">${product.price.toLocaleString()} VNƒê</div>
          <div class="stock">S·ªë l∆∞·ª£ng c√≤n: ${stock[product.name]} ${stockMsg}</div>
          <div>
            ${[1,2,3,4,5].map(i => `<span class="star" onclick="rateProduct('${product.name}',${i})">${i <= rating ? "‚òÖ" : "‚òÜ"}</span>`).join('')}
          </div>
          <button onclick="addToCart('${product.name}')" ${stock[product.name] === 0 ? "disabled style='background:#ccc;'" : ""}>Th√™m v√†o gi·ªè</button>
          <button onclick="toggleFavorite('${product.name}')" style="background:${isFav ? '#ffcc00' : '#ffe4ef'};color:${isFav ? '#ad1457' : '#d63384'};margin-top:6px;">
            <i class="fa fa-heart"></i> ${isFav ? 'B·ªè y√™u th√≠ch' : 'Y√™u th√≠ch'}
          </button>
        </div>
      `}).join('');
    }

    function addToCart(productName) {
      const product = products.find(p => p.name === productName);
      const item = cart.find(i => i.name === productName);
      let qty = 1;
      let inputQty = prompt("Nh·∫≠p s·ªë l∆∞·ª£ng mu·ªën mua:", "1");
      if (inputQty && !isNaN(inputQty) && Number(inputQty) > 0) {
        qty = Number(inputQty);
      }
      if (stock[productName] < qty) {
        showToast("S·∫£n ph·∫©m ƒë√£ h·∫øt h√†ng ho·∫∑c kh√¥ng ƒë·ªß s·ªë l∆∞·ª£ng!");
        return;
      }
      stock[productName] -= qty;
      if (item) {
        item.qty += qty;
      } else {
        cart.push({ name: product.name, img: product.img, price: product.price, qty });
      }
      renderProducts(); // c·∫≠p nh·∫≠t l·∫°i danh s√°ch s·∫£n ph·∫©m
      renderCart();
      updateCartIcon();
      showToast("ƒê√£ th√™m v√†o gi·ªè h√†ng!");
    }

    function removeFromCart(productName) {
      cart = cart.filter(i => i.name !== productName);
      renderCart();
      updateCartIcon();
    }

    function renderCart() {
      const cartList = document.getElementById('cartList');
      const cartTotal = document.getElementById('cartTotal');
      if (cart.length === 0) {
        cartList.innerHTML = '<li>Gi·ªè h√†ng tr·ªëng.</li>';
        cartTotal.textContent = '';
        return;
      }
      let total = 0;
      cartList.innerHTML = cart.map(item => {
        total += item.price * item.qty;
        return `
          <li>
            <img src="${item.img}" alt="${item.name}">
            <span>${item.name} x${item.qty}</span>
            <span>${(item.price * item.qty).toLocaleString()} VNƒê</span>
            <button onclick="removeFromCart('${item.name}')">X√≥a</button>
          </li>
        `;
      }).join('');
      let voucherValue = appliedVoucher && total >= 300000 ? appliedVoucher.value : 0;
      cartTotal.innerHTML = "T·ªïng ti·ªÅn: " + (total - voucherValue).toLocaleString() + " VNƒê"
        + (voucherValue ? ` <span style='color:#ad1457;'>(ƒê√£ gi·∫£m ${voucherValue.toLocaleString()} VNƒê)</span>` : "")
        + `<br>ƒêi·ªÉm t√≠ch l≈©y: ${getUserPoint().toLocaleString()} VNƒê`;
    }

    function updateCartIcon() {
      const cartCount = document.getElementById('cartCount');
      cartCount.textContent = cart.reduce((sum, item) => sum + item.qty, 0);
    }

    function searchProducts() {
      const keyword = document.getElementById('searchInput').value.trim();
      const type = document.getElementById('filterType').value;
      const price = document.getElementById('filterPrice').value;
      renderProducts(keyword, type, price);
    }

    function filterProducts() {
      searchProducts();
    }

    function showDetail(productName) {
      const product = products.find(p => p.name === productName);
      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modalContent');
      const ratingArr = productRatings[product.name] || [];
      const rating = ratingArr.length ? Math.round(ratingArr.reduce((a,b)=>a+b,0)/ratingArr.length) : 0;
      const comments = productComments[product.name] || [];
      const reviewImgs = productReviewImages[product.name] || [];
      modalContent.innerHTML = `
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <img src="${product.img}" alt="${product.name}">
        <h2>${product.name}</h2>
        <div style="color:#ff5722;font-weight:bold;">${product.price.toLocaleString()} VNƒê</div>
        <div style="margin:8px 0;">${product.desc}</div>
        <div>
          <strong>ƒê√°nh gi√°: </strong>
          ${[1,2,3,4,5].map(i => `<span class="star" onclick="rateProduct('${product.name}',${i})">${i <= rating ? "‚òÖ" : "‚òÜ"}</span>`).join('')}
          <span style="color:#ad1457;">(${ratingArr.length} l∆∞·ª£t, trung b√¨nh ${rating}/5)</span>
        </div>
        <div style="margin:8px 0;">
          <input type="text" id="commentInput" placeholder="B√¨nh lu·∫≠n v·ªÅ s·∫£n ph·∫©m..." style="width:70%;">
          <input type="file" id="reviewImgInput" accept="image/*" style="width:25%;">
          <button onclick="addComment('${product.name}')">G·ª≠i</button>
        </div>
        <div>
          <strong>B√¨nh lu·∫≠n & h√¨nh ·∫£nh:</strong>
          <ul style="text-align:left;">
            ${comments.map((c, idx) => `<li>${c}${reviewImgs[idx] ? `<br><img src="${reviewImgs[idx]}" style="width:80px;border-radius:8px;margin-top:4px;">` : ""}</li>`).join('')}
          </ul>
        </div>
      `;
      modal.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function rateProduct(productName, rating) {
      if (!productRatings[productName]) productRatings[productName] = [];
      productRatings[productName].push(rating);
      renderProducts();
      showDetail(productName);
      showToast("C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√°!");
    }

    function addComment(productName) {
      const input = document.getElementById('commentInput');
      const value = input.value.trim();
      const imgInput = document.getElementById('reviewImgInput');
      if (!value && !imgInput.files.length) return;
      if (!productComments[productName]) productComments[productName] = [];
      productComments[productName].push(value || "(Kh√¥ng c√≥ b√¨nh lu·∫≠n)");
      if (!productReviewImages[productName]) productReviewImages[productName] = [];
      if (imgInput.files.length) {
        const reader = new FileReader();
        reader.onload = function(e) {
          productReviewImages[productName].push(e.target.result);
          showDetail(productName);
        };
        reader.readAsDataURL(imgInput.files[0]);
      } else {
        productReviewImages[productName].push("");
        showDetail(productName);
      }
      showToast("ƒê√£ g·ª≠i b√¨nh lu·∫≠n!");
    }

    function showService(service) {
      document.getElementById('service4g').style.display = service === '4g' ? 'block' : 'none';
      document.getElementById('serviceDoAn').style.display = service === 'doan' ? 'block' : 'none';
    }
    function hideService(service) {
      if (service === '4g') {
        document.getElementById('service4g').style.display = 'none';
      } else if (service === 'doan') {
        document.getElementById('serviceDoAn').style.display = 'none';
      }
    }

    function dangKy4G() {
      const soDT = document.getElementById('soDT').value.trim();
      const ketQua4G = document.getElementById('ketQua4G');
      if (!soDT.match(/^0\d{9}$/)) {
        ketQua4G.textContent = "Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá!";
        ketQua4G.style.color = "red";
        return;
      }
      ketQua4G.textContent = "ƒêƒÉng k√Ω 4G th√†nh c√¥ng cho s·ªë: " + soDT;
      ketQua4G.style.color = "#ad1457";
    }

    function datDoAn() {
      const radios = document.querySelectorAll('input[name="doAn"]');
      let doAn = "";
      let price = 0;
      radios.forEach(r => {
        if (r.checked) {
          doAn = r.value;
          price = Number(r.getAttribute('data-price'));
        }
      });
      const soLuong = parseInt(document.getElementById('soLuongDoAn').value, 10);
      const diaChi = document.getElementById('diaChiDoAn').value.trim();
      const ptThanhToan = document.getElementById('ptThanhToanDoAn').value;
      const ketQuaDoAn = document.getElementById('ketQuaDoAn');

      if (!doAn) {
        ketQuaDoAn.textContent = "Vui l√≤ng ch·ªçn m√≥n!";
        ketQuaDoAn.style.color = "red";
        return;
      }
      if (!soLuong || soLuong < 1) {
        ketQuaDoAn.textContent = "Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng h·ª£p l·ªá!";
        ketQuaDoAn.style.color = "red";
        return;
      }
      if (!diaChi) {
        ketQuaDoAn.textContent = "Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n m√≥n!";
        ketQuaDoAn.style.color = "red";
        return;
      }
      if (!ptThanhToan) {
        ketQuaDoAn.textContent = "Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n!";
        ketQuaDoAn.style.color = "red";
        return;
      }
      ketQuaDoAn.innerHTML = `
        <span style="color:#ad1457;">
          B·∫°n ƒë√£ ƒë·∫∑t <b>${soLuong}</b> <b>${doAn}</b> (${(price * soLuong).toLocaleString()}ƒë)
          t·ªõi ƒë·ªãa ch·ªâ "<b>${diaChi}</b>" b·∫±ng ph∆∞∆°ng th·ª©c "<b>${ptThanhToan}</b>".<br>
          ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c giao s·ªõm!
        </span>
      `;
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, 3000);
    }

    // N√¢ng c·∫•p l·ªãch s·ª≠ ƒë∆°n h√†ng: hi·ªÉn th·ªã chi ti·∫øt t·ª´ng ƒë∆°n, tr·∫°ng th√°i, n√∫t ƒë√°nh gi√° ƒë∆°n h√†ng
    function renderHistory() {
      const user = users.find(u => u.username === loggedInUser);
      const historyDiv = document.getElementById('history');
      if (!user || !user.history || user.history.length === 0) {
        historyDiv.style.display = 'none';
        return;
      }
      historyDiv.style.display = 'block';
      document.getElementById('historyList').innerHTML = user.history.map((h, idx) => {
        // Tr·∫°ng th√°i ƒë∆°n h√†ng: m·∫∑c ƒë·ªãnh l√† "ƒê√£ giao" n·∫øu kh√¥ng c√≥
        let status = h.status || "ƒê√£ giao";
        // ƒê√°nh gi√° ƒë∆°n h√†ng
        let reviewHtml = "";
        if (!h.reviewed) {
          reviewHtml = `<button onclick="reviewOrder(${idx})" style="background:#ff5722;color:#fff;border:none;border-radius:6px;padding:4px 12px;cursor:pointer;">ƒê√°nh gi√° ƒë∆°n</button>`;
        } else {
          reviewHtml = `<span style="color:#ad1457;">ƒê√£ ƒë√°nh gi√°: ${h.reviewScore || ""}/5</span>`;
        }
        return `
          <li>
            <div><b>Ng√†y:</b> ${h.date}</div>
            <div><b>S·∫£n ph·∫©m:</b> ${h.items.map(i => `${i.name} x${i.qty}`).join(', ')}</div>
            <div><b>T·ªïng ti·ªÅn:</b> ${h.total.toLocaleString()} VNƒê</div>
            <div><b>ƒê·ªãa ch·ªâ:</b> ${h.address}</div>
            <div><b>V·∫≠n chuy·ªÉn:</b> ${h.shipping}</div>
            <div><b>Tr·∫°ng th√°i:</b> <span style="color:#ff5722;">${status}</span></div>
            <div>${reviewHtml}</div>
          </li>
        `;
      }).join('');
    }

    // H√†m ƒë√°nh gi√° ƒë∆°n h√†ng
    function reviewOrder(idx) {
      const user = users.find(u => u.username === loggedInUser);
      let score = prompt("ƒê√°nh gi√° ƒë∆°n h√†ng n√†y (1-5):", "5");
      score = Number(score);
      if (isNaN(score) || score < 1 || score > 5) {
        alert("Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn 5!");
        return;
      }
      user.history[idx].reviewed = true;
      user.history[idx].reviewScore = score;
      renderHistory();
      showToast("C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√° ƒë∆°n h√†ng!");
    }

    // ƒêa ng√¥n ng·ªØ (ch·ªâ demo cho m·ªôt s·ªë text)
    const LANGS = {
      vi: {
        login: "ƒêƒÉng nh·∫≠p",
        register: "T·∫°o t√†i kho·∫£n",
        username: "T√™n t√†i kho·∫£n",
        password: "M·∫≠t kh·∫©u",
        forgot: "Qu√™n m·∫≠t kh·∫©u?",
        send: "G·ª≠i",
        chatTitle: "H·ªó tr·ª£ tr·ª±c tuy·∫øn",
        chatPlaceholder: "Nh·∫≠p c√¢u h·ªèi...",
        close: "ƒê√≥ng",
        address: "Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng chi ti·∫øt (s·ªë nh√†, ph∆∞·ªùng, qu·∫≠n...)",
        shipping: "Ch·ªçn ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn (Nhanh/Ti·∫øt ki·ªám):",
        checkoutSuccess: "ƒê·∫∑t h√†ng th√†nh c√¥ng!",
        cartEmpty: "Gi·ªè h√†ng tr·ªëng!",
        notAddress: "B·∫°n ch∆∞a nh·∫≠p ƒë·ªãa ch·ªâ!",
        voucher: "M√£ gi·∫£m gi√°",
        apply: "√Åp d·ª•ng",
        selectVoucher: "Ch·ªçn m√£ gi·∫£m gi√°",
        selectLang: "Ng√¥n ng·ªØ"
      },
      en: {
        login: "Login",
        register: "Register",
        username: "Username",
        password: "Password",
        forgot: "Forgot password?",
        send: "Send",
        chatTitle: "Live Support",
        chatPlaceholder: "Type your question...",
        close: "Close",
        address: "Enter delivery address (street, ward, district...)",
        shipping: "Choose shipping method (Fast/Economy):",
        checkoutSuccess: "Order placed successfully!",
        cartEmpty: "Cart is empty!",
        notAddress: "You haven't entered address!",
        voucher: "Voucher",
        apply: "Apply",
        selectVoucher: "Choose voucher",
        selectLang: "Language"
      }
    };

    // Thay ƒë·ªïi ng√¥n ng·ªØ
    function changeLang(lang) {
      currentLang = lang;
      document.getElementById('loginBtn').textContent = LANGS[lang].login;
      document.getElementById('registerBtn').textContent = LANGS[lang].register;
      document.getElementById('regUsernameLabel').textContent = LANGS[lang].username + ":";
      document.getElementById('regPasswordLabel').textContent = LANGS[lang].password + ":";
      document.getElementById('loginUsernameLabel').textContent = LANGS[lang].username + ":";
      document.getElementById('loginPasswordLabel').textContent = LANGS[lang].password + ":";
      document.getElementById('forgotLink').textContent = LANGS[lang].forgot;
      document.getElementById('chatTitle').textContent = LANGS[lang].chatTitle;
      document.getElementById('chatInput').placeholder = LANGS[lang].chatPlaceholder;
      document.getElementById('closeChatBtn').textContent = LANGS[lang].close;
      document.getElementById('voucherLabel').textContent = LANGS[lang].voucher + ":";
      document.getElementById('applyVoucherBtn').textContent = LANGS[lang].apply;
      document.getElementById('selectVoucherLabel').textContent = LANGS[lang].selectVoucher + ":";
      document.getElementById('selectLangLabel').textContent = LANGS[lang].selectLang + ":";
    }

    // Qu√™n m·∫≠t kh·∫©u
    function showForgotModal() {
      document.getElementById('forgotModal').style.display = 'flex';
      forgotModalOpen = true;
    }
    function closeForgotModal() {
      document.getElementById('forgotModal').style.display = 'none';
      forgotModalOpen = false;
    }
    function sendForgot() {
      const username = document.getElementById('forgotUsername').value.trim();
      if (!username) {
        alert("Vui l√≤ng nh·∫≠p t√™n t√†i kho·∫£n!");
        return;
      }
      alert("M·∫≠t kh·∫©u c·ªßa b·∫°n l√†: " + (users.find(u => u.username === username)?.password || "Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n!"));
      closeForgotModal();
    }

    // ƒê·ªïi m·∫≠t kh·∫©u
    function showChangePassModal() {
      document.getElementById('changePassModal').style.display = 'flex';
    }
    function closeChangePassModal() {
      document.getElementById('changePassModal').style.display = 'none';
    }
    function sendChangePass() {
      const oldPass = document.getElementById('oldPass').value;
      const newPass = document.getElementById('newPass').value;
      const user = users.find(u => u.username === loggedInUser);
      if (!oldPass || !newPass) {
        alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
        return;
      }
      if (user.password !== oldPass) {
        alert("M·∫≠t kh·∫©u c≈© kh√¥ng ƒë√∫ng!");
        return;
      }
      user.password = newPass;
      alert("ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!");
      closeChangePassModal();
    }

    // √Åp d·ª•ng voucher
    let appliedVoucher = null;
    function applyVoucher() {
      const code = document.getElementById('voucherSelect').value;
      appliedVoucher = vouchers.find(v => v.code === code);
      showToast("√Åp d·ª•ng m√£ gi·∫£m gi√°: " + (appliedVoucher?.code || ""));
      renderCart();
    }

    // T√≠ch ƒëi·ªÉm
    function getUserPoint() {
      const user = users.find(u => u.username === loggedInUser);
      return user?.history?.reduce((sum, h) => sum + h.total, 0) || 0;
    }

    // Qu·∫£n l√Ω kho (s·ªë l∆∞·ª£ng t·ªìn)
    let stock = {
      "Son m√¥i": 10,
      "Kem d∆∞·ª°ng": 8,
      "M·∫∑t n·∫°": 20,
      "Ph·∫•n ph·ªß": 5,
      "S·ªØa r·ª≠a m·∫∑t": 12,
      "T·∫©y trang": 7,
      "Kem ch·ªëng n·∫Øng": 6,
      "Serum": 9
    };

    // B·∫£n ƒë·ªì ch·ªçn ƒë·ªãa ch·ªâ
    function showMapBox() {
      document.getElementById('mapBox').style.display = 'block';
    }
    function hideMapBox() {
      document.getElementById('mapBox').style.display = 'none';
    }

    // Chat h·ªó tr·ª£
    function toggleChat() {
      const chatBox = document.getElementById('chatBox');
      chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
      renderChat();
    }

    function sendChat() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;
      saveChatHistory(loggedInUser, { sender: "user", text });
      const reply = chatbotReply(text);
      saveChatHistory(loggedInUser, { sender: "shop", text: reply });
      input.value = "";
      renderChat();
    }

    function renderChat() {
      const chatMessages = document.getElementById('chatMessages');
      const history = getChatHistory(loggedInUser);
      chatMessages.innerHTML = history.map(c => `<div><b>${c.sender === "shop" ? "Shop" : "B·∫°n"}:</b> ${c.text}</div>`).join('');
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // L∆∞u l·ªãch s·ª≠ chat cho t·ª´ng t√†i kho·∫£n
    function saveChatHistory(username, msg) {
      if (!username) return;
      if (!window.allChatHistory) window.allChatHistory = {};
      if (!window.allChatHistory[username]) window.allChatHistory[username] = [];
      window.allChatHistory[username].push(msg);
    }
    function getChatHistory(username) {
      if (!window.allChatHistory) window.allChatHistory = {};
      if (!window.allChatHistory[username]) window.allChatHistory[username] = [
        { sender: "shop", text: "Xin ch√†o! B·∫°n c·∫ßn h·ªó tr·ª£ g√¨?" }
      ];
      return window.allChatHistory[username];
    }

    // Chatbot t·ª± ƒë·ªông tr·∫£ l·ªùi
    function chatbotReply(text) {
      text = text.toLowerCase();
      if (text.includes("gi√°") || text.includes("bao nhi√™u")) return "B·∫°n vui l√≤ng xem gi√° t·ª´ng s·∫£n ph·∫©m tr√™n website nh√©!";
      if (text.includes("khuy·∫øn m√£i") || text.includes("sale")) return "Shop ƒëang c√≥ ch∆∞∆°ng tr√¨nh SALE50 v√† FREESHIP, b·∫°n nh·∫≠p m√£ khi thanh to√°n nh√©!";
      if (text.includes("giao h√†ng") || text.includes("ship")) return "Shop giao h√†ng to√†n qu·ªëc, b·∫°n nh·∫≠p ƒë·ªãa ch·ªâ khi ƒë·∫∑t h√†ng nh√©!";
      if (text.includes("ƒë·∫∑t ƒë·ªì ƒÉn")) return "B·∫°n v√†o m·ª•c ƒê·∫∑t ƒë·ªì ƒÉn ƒë·ªÉ ch·ªçn m√≥n v√† ƒë·∫∑t nh√©!";
      if (text.includes("ƒëƒÉng nh·∫≠p") || text.includes("t√†i kho·∫£n")) return "N·∫øu b·∫°n ch∆∞a c√≥ t√†i kho·∫£n, h√£y ƒëƒÉng k√Ω m·ªõi nh√©!";
      if (text.includes("m·ªπ ph·∫©m")) return "Shop c√≥ nhi·ªÅu lo·∫°i m·ªπ ph·∫©m ch√≠nh h√£ng, b·∫°n xem danh m·ª•c s·∫£n ph·∫©m nh√©!";
      if (text.includes("c·∫£m ∆°n")) return "Shop c·∫£m ∆°n b·∫°n ƒë√£ quan t√¢m!";
      return "Shop ƒë√£ nh·∫≠n c√¢u h·ªèi: " + text;
    }

    // Kh·ªüi t·∫°o s·∫£n ph·∫©m khi ƒëƒÉng nh·∫≠p
    if (loggedInUser) {
      renderProducts();
      renderCart();
      renderHistory();
      updateCartIcon();
    }
    showBanner();
    changeLang("vi");

    // B·∫£n ƒë·ªì Google Maps
    function showMap() {
      const addr = document.getElementById('mapAddress').value.trim();
      if (!addr) return;
      document.getElementById('mapFrame').src = `https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${encodeURIComponent(addr)}`;
    }

    // H√†m hi·ªÉn th·ªã th√¥ng b√°o realtime
    function showNotification(msg, timeout = 5000) {
      document.getElementById('notificationMsg').textContent = msg;
      document.getElementById('notificationBar').style.display = 'block';
      if (timeout > 0) {
        setTimeout(hideNotification, timeout);
      }
    }
    function hideNotification() {
      document.getElementById('notificationBar').style.display = 'none';
    }

    // Th√¥ng b√°o khuy·∫øn m√£i khi ƒëƒÉng nh·∫≠p
    function showBanner() {
      document.getElementById('banner').style.background = "url('https://cf.shopee.vn/file/vn-50009109-7e4e2b6e7b6e7b6e7b6e7b6e7b6e7b6e') center/cover no-repeat";
      document.getElementById('banner').innerHTML = "<span>M·ªπ ph·∫©m ch√≠nh h√£ng - Khuy·∫øn m√£i HOT! SALE50 - FREESHIP</span>";
      showNotification("üéâ ƒêang c√≥ khuy·∫øn m√£i SALE50 v√† FREESHIP! Nh·∫≠p m√£ khi thanh to√°n ƒë·ªÉ nh·∫≠n ∆∞u ƒë√£i.", 7000);
    }

    // Th√¥ng b√°o tr·∫°ng th√°i ƒë∆°n h√†ng khi ƒë·∫∑t h√†ng
    function checkout() {
      if (cart.length === 0) {
        showToast(LANGS[currentLang].cartEmpty);
        return;
      }
      let address = prompt(LANGS[currentLang].address, "");
      if (!address) {
        showToast(LANGS[currentLang].notAddress);
        return;
      }
      showMapBox();
      let shipping = prompt(LANGS[currentLang].shipping, "Nhanh");
      if (!shipping) shipping = "Nhanh";
      let total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
      let voucherValue = appliedVoucher && total >= 300000 ? appliedVoucher.value : 0;
      total = total - voucherValue;
      const user = users.find(u => u.username === loggedInUser);
      const now = new Date();
      user.history = user.history || [];
      user.history.push({
        date: now.toLocaleString(),
        items: cart.map(i => ({ name: i.name, qty: i.qty })),
        total,
        address,
        shipping,
        status: "ƒêang x·ª≠ l√Ω"
      });
      renderHistory();
      cart = [];
      renderCart();
      updateCartIcon();
      showToast(LANGS[currentLang].checkoutSuccess);
      hideMapBox();
      showNotification("üõí ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·∫°o! Shop s·∫Ω x√°c nh·∫≠n v√† giao h√†ng s·ªõm.", 7000);

      // Gi·∫£ l·∫≠p c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng sau 5 gi√¢y
      setTimeout(() => {
        const lastOrder = user.history[user.history.length - 1];
        if (lastOrder) {
          lastOrder.status = "ƒê√£ giao";
          renderHistory();
          showNotification("‚úÖ ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c giao th√†nh c√¥ng!", 7000);
        }
      }, 5000);
    }
  </script>
</head>
<body>
  <div class="navbar">
    <h1><i class="fa-solid fa-bag-shopping"></i> Shopee M·ªπ Ph·∫©m</h1>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
      <button id="searchBtn" onclick="searchProducts()"><i class="fa fa-search"></i></button>
      <select id="filterType" onchange="filterProducts()">
        <option value="">T·∫•t c·∫£ lo·∫°i</option>
        <option value="Trang ƒëi·ªÉm">Trang ƒëi·ªÉm</option>
        <option value="ChƒÉm s√≥c da">ChƒÉm s√≥c da</option>
      </select>
      <select id="filterPrice" onchange="filterProducts()">
        <option value="">T·∫•t c·∫£ gi√°</option>
        <option value="1">D∆∞·ªõi 100.000</option>
        <option value="2">100.000 - 200.000</option>
        <option value="3">Tr√™n 200.000</option>
      </select>
    </div>
    <div class="user" id="welcome"></div>
    <div class="cart-icon" onclick="document.getElementById('mainContent').scrollIntoView({behavior:'smooth'})">
      <i class="fa-solid fa-cart-shopping"></i>
      <span class="cart-count" id="cartCount">0</span>
    </div>
  </div>
  <div class="container">
    <div class="banner" id="banner"><span>M·ªπ ph·∫©m ch√≠nh h√£ng - Khuy·∫øn m√£i HOT!</span></div>
    <div class="voucher-bar">
      <label id="voucherLabel" for="voucherSelect">M√£ gi·∫£m gi√°:</label>
      <select id="voucherSelect">
        <option value="">--Ch·ªçn m√£--</option>
        <option value="SALE50">SALE50 - Gi·∫£m 50.000 cho ƒë∆°n t·ª´ 300.000</option>
        <option value="FREESHIP">FREESHIP - Gi·∫£m 20.000 ph√≠ ship</option>
      </select>
      <button id="applyVoucherBtn" onclick="applyVoucher()">√Åp d·ª•ng</button>
    </div>
    <div id="userInfo">
      <img id="infoAvatar" src="" alt="Avatar" style="display:none;">
      <h3>Th√¥ng tin t√†i kho·∫£n</h3>
      <p><strong>T√™n ƒëƒÉng nh·∫≠p:</strong> <span id="infoUsername"></span></p>
      <form id="bgForm">
        <label for="bgInput">Ch·ªçn ·∫£nh n·ªÅn cho t√†i kho·∫£n:</label>
        <input type="file" id="bgInput" accept="image/*" onchange="updateBg(event)">
      </form>
      <form id="avatarForm">
        <label for="avatarInput">Ch·ªçn ·∫£nh ƒë·∫°i di·ªán:</label>
        <input type="file" id="avatarInput" accept="image/*" onchange="updateAvatar(event)">
      </form>
      <button onclick="showChangePassModal()">ƒê·ªïi m·∫≠t kh·∫©u</button>
    </div>
    <div id="loginForm">
      <div style="text-align:center;margin-bottom:16px;">
        <img src="https://cdn.pixabay.com/photo/2017/01/06/19/15/pig-1956159_1280.png" alt="Heo Shopee" style="width:100px;height:100px;border-radius:50%;box-shadow:0 2px 8px #d6338440;">
      </div>
      <h2 id="loginTitle" style="text-align:center;">ƒêƒÉng nh·∫≠p</h2>
      <label id="loginUsernameLabel" for="loginUsername">T√™n t√†i kho·∫£n:</label>
      <input type="text" id="loginUsername" placeholder="Nh·∫≠p t√™n t√†i kho·∫£n"><br>
      <label id="loginPasswordLabel" for="loginPassword">M·∫≠t kh·∫©u:</label>
      <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u"><br>
      <div style="display:flex;gap:12px;justify-content:center;margin-top:16px;">
        <button id="loginBtn" onclick="loginAccount()">ƒêƒÉng nh·∫≠p</button>
        <button type="button" onclick="showRegister()">T·∫°o t√†i kho·∫£n</button>
      </div>
    </div>
    <div id="registerForm" style="display:none;">
      <div style="text-align:center;margin-bottom:16px;">
        <img src="https://cdn.pixabay.com/photo/2017/01/06/19/15/pig-1956159_1280.png" alt="Heo Shopee" style="width:100px;height:100px;border-radius:50%;box-shadow:0 2px 8px #d6338440;">
      </div>
      <h2 id="registerTitle" style="text-align:center;">T·∫°o t√†i kho·∫£n</h2>
      <label id="regUsernameLabel" for="regUsername">T√™n t√†i kho·∫£n:</label>
      <input type="text" id="regUsername" placeholder="Nh·∫≠p t√™n t√†i kho·∫£n"><br>
      <label id="regPasswordLabel" for="regPassword">M·∫≠t kh·∫©u:</label>
      <input type="password" id="regPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u"><br>
      <div style="display:flex;gap:12px;justify-content:center;margin-top:16px;">
        <button id="registerBtn" onclick="registerAccount()">ƒêƒÉng k√Ω</button>
        <button type="button" onclick="showLogin()">ƒêƒÉng nh·∫≠p</button>
      </div>
    </div>
    <div id="mainContent" style="display:none;">
      <div class="filter-bar">
        <input type="text" id="searchInput2" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." oninput="searchProducts()">
        <select id="filterType2" onchange="filterProducts()">
          <option value="">T·∫•t c·∫£ lo·∫°i</option>
          <option value="Trang ƒëi·ªÉm">Trang ƒëi·ªÉm</option>
          <option value="ChƒÉm s√≥c da">ChƒÉm s√≥c da</option>
        </select>
        <select id="filterPrice2" onchange="filterProducts()">
          <option value="">T·∫•t c·∫£ gi√°</option>
          <option value="1">D∆∞·ªõi 100.000</option>
          <option value="2">100.000 - 200.000</option>
          <option value="3">Tr√™n 200.000</option>
        </select>
      </div>
      <div class="product-list" id="productList"></div>
      <div class="cart">
        <h2>Gi·ªè h√†ng</h2>
        <ul class="cart-list" id="cartList"></ul>
        <div class="cart-total" id="cartTotal"></div>
        <button onclick="checkout()">Thanh to√°n</button>
      </div>
      <div class="history" id="history" style="display:none;">
        <h2>L·ªãch s·ª≠ ƒë∆°n h√†ng</h2>
        <ul class="history-list" id="historyList"></ul>
      </div>
      <div class="service-btns">
        <button onclick="showService('4g')">ƒêƒÉng k√Ω 4G</button>
        <button onclick="showService('doan')">ƒê·∫∑t ƒë·ªì ƒÉn</button>
        <button onclick="showFavorites()" style="background:#ffcc00;color:#ad1457;"><i class="fa fa-heart"></i> S·∫£n ph·∫©m y√™u th√≠ch</button>
      </div>
      <div id="service4g" class="service-form" style="display:none;">
        <form onsubmit="event.preventDefault(); dangKy4G();">
          <label for="soDT">Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ ƒëƒÉng k√Ω 4G:</label>
          <input type="text" id="soDT" placeholder="S·ªë ƒëi·ªán tho·∫°i">
          <button type="submit">ƒêƒÉng k√Ω 4G</button>
          <div id="ketQua4G"></div>
          <button type="button" onclick="hideService('4g')">ƒê√≥ng</button>
        </form>
      </div>
      <div id="serviceDoAn" class="service-form" style="display:none;">
        <form id="formDoAn" onsubmit="event.preventDefault(); datDoAn();">
          <label for="doAn">Ch·ªçn m√≥n ƒÉn:</label>
          <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 12px;">
            <div style="text-align:center;">
              <img src="https://cdn.pixabay.com/photo/2017/01/22/19/20/tea-1996029_1280.jpg" alt="Tr√† s·ªØa" style="width:60px;height:60px;border-radius:8px;">
              <br>
              <input type="radio" name="doAn" id="doAn1" value="Tr√† s·ªØa" data-price="35000">
              <label for="doAn1">Tr√† s·ªØa<br><span style="color:#ff5722;">35.000ƒë</span></label>
            </div>
            <div style="text-align:center;">
              <img src="https://cdn.pixabay.com/photo/2016/03/05/19/02/bread-1239266_1280.jpg" alt="B√°nh m√¨" style="width:60px;height:60px;border-radius:8px;">
              <br>
              <input type="radio" name="doAn" id="doAn2" value="B√°nh m√¨" data-price="25000">
              <label for="doAn2">B√°nh m√¨<br><span style="color:#ff5722;">25.000ƒë</span></label>
            </div>
            <div style="text-align:center;">
              <img src="https://cdn.pixabay.com/photo/2017/07/16/10/43/rice-2502272_1280.jpg" alt="C∆°m t·∫•m" style="width:60px;height:60px;border-radius:8px;">
              <br>
              <input type="radio" name="doAn" id="doAn3" value="C∆°m t·∫•m" data-price="40000">
              <label for="doAn3">C∆°m t·∫•m<br><span style="color:#ff5722;">40.000ƒë</span></label>
            </div>
            <div style="text-align:center;">
              <img src="https://cdn.pixabay.com/photo/2017/06/02/18/24/noodle-2366648_1280.jpg" alt="Ph·ªü" style="width:60px;height:60px;border-radius:8px;">
              <br>
              <input type="radio" name="doAn" id="doAn4" value="Ph·ªü" data-price="45000">
              <label for="doAn4">Ph·ªü<br><span style="color:#ff5722;">45.000ƒë</span></label>
            </div>
            <div style="text-align:center;">
              <img src="https://cdn.pixabay.com/photo/2017/06/02/18/24/chicken-2366647_1280.jpg" alt="G√† r√°n" style="width:60px;height:60px;border-radius:8px;">
              <br>
              <input type="radio" name="doAn" id="doAn5" value="G√† r√°n" data-price="50000">
              <label for="doAn5">G√† r√°n<br><span style="color:#ff5722;">50.000ƒë</span></label>
            </div>
            <div style="text-align:center;">
              <img src="https://cdn.pixabay.com/photo/2017/06/02/18/24/pizza-2366649_1280.jpg" alt="Pizza" style="width:60px;height:60px;border-radius:8px;">
              <br>
              <input type="radio" name="doAn" id="doAn6" value="Pizza" data-price="65000">
              <label for="doAn6">Pizza<br><span style="color:#ff5722;">65.000ƒë</span></label>
            </div>
          </div>
          <label for="soLuongDoAn">S·ªë l∆∞·ª£ng:</label>
          <input type="number" id="soLuongDoAn" min="1" value="1" required>
          <label for="diaChiDoAn">ƒê·ªãa ch·ªâ nh·∫≠n m√≥n:</label>
          <input type="text" id="diaChiDoAn" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n m√≥n" required>
          <label for="ptThanhToanDoAn">Ph∆∞∆°ng th·ª©c thanh to√°n:</label>
          <select id="ptThanhToanDoAn" required>
            <option value="">-- Ch·ªçn ph∆∞∆°ng th·ª©c --</option>
            <option value="Ti·ªÅn m·∫∑t">Ti·ªÅn m·∫∑t</option>
            <option value="Chuy·ªÉn kho·∫£n">Chuy·ªÉn kho·∫£n</option>
            <option value="V√≠ ƒëi·ªán t·ª≠">V√≠ ƒëi·ªán t·ª≠</option>
          </select>
          <div style="margin:12px 0;">
            <strong>T·ªïng ti·ªÅn: <span id="tongTienDoAn" style="color:#ff5722;">0ƒë</span></strong>
          </div>
          <button type="submit">ƒê·∫∑t m√≥n</button>
          <div id="ketQuaDoAn"></div>
          <button type="button" onclick="hideService('doan')">ƒê√≥ng</button>
        </form>
      </div>
      <div class="map-box" id="mapBox" style="display:none;">
        <input type="text" id="mapAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ƒë·ªÉ xem b·∫£n ƒë·ªì">
        <button onclick="showMap()">Xem b·∫£n ƒë·ªì</button>
        <iframe id="mapFrame" src="" frameborder="0"></iframe>
        <button onclick="hideMapBox()">ƒê√≥ng b·∫£n ƒë·ªì</button>
      </div>
    </div>
    <div id="toast" class="toast"></div>
    <div id="modal" class="modal">
      <div class="modal-content" id="modalContent"></div>
    </div>
    <!-- Qu√™n m·∫≠t kh·∫©u -->
    <div id="forgotModal" class="modal-small">
      <div class="modal-small-content">
        <span class="close-modal-small" onclick="closeForgotModal()">&times;</span>
        <h3>Qu√™n m·∫≠t kh·∫©u</h3>
        <input type="text" id="forgotUsername" placeholder="Nh·∫≠p t√™n t√†i kho·∫£n">
        <button onclick="sendForgot()">G·ª≠i</button>
      </div>
    </div>
    <!-- ƒê·ªïi m·∫≠t kh·∫©u -->
    <div id="changePassModal" class="modal-small">
      <div class="modal-small-content">
        <span class="close-modal-small" onclick="closeChangePassModal()">&times;</span>
        <h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>
        <input type="password" id="oldPass" placeholder="M·∫≠t kh·∫©u c≈©">
        <input type="password" id="newPass" placeholder="M·∫≠t kh·∫©u m·ªõi">
        <button onclick="sendChangePass()">ƒê·ªïi m·∫≠t kh·∫©u</button>
      </div>
    </div>
    <!-- Chat h·ªó tr·ª£ -->
    <div class="chat-toggle" onclick="toggleChat()">üí¨</div>
    <div class="chat-box" id="chatBox">
      <div class="chat-header" id="chatTitle">H·ªó tr·ª£ tr·ª±c tuy·∫øn</div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Nh·∫≠p c√¢u h·ªèi...">
        <button onclick="sendChat()">G·ª≠i</button>
        <button id="closeChatBtn" onclick="toggleChat()">ƒê√≥ng</button>
      </div>
    </div>
    <!-- Danh s√°ch y√™u th√≠ch -->
    <div id="favoritesModal" class="modal">
      <div class="modal-content" id="favoritesContent"></div>
    </div>
    <!-- Th√™m th√¥ng b√°o realtime khi c√≥ khuy·∫øn m√£i ho·∫∑c ƒë∆°n h√†ng thay ƒë·ªïi tr·∫°ng th√°i -->
    <div id="notificationBar" style="display:none;position:fixed;top:0;left:0;width:100%;z-index:99999;background:#ffcc00;color:#ad1457;text-align:center;padding:12px;font-weight:bold;box-shadow:0 2px 8px #d6338440;">
      <span id="notificationMsg"></span>
      <button onclick="hideNotification()" style="margin-left:16px;background:#d63384;color:#fff;border:none;border-radius:6px;padding:4px 12px;cursor:pointer;">ƒê√≥ng</button>
    </div>
  </div>
</body>
</html>